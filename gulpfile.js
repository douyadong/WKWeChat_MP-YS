'use strict' ;
var gulp = require("gulp") ;
var clean = require("gulp-clean") ;
var less = require("gulp-less") ;
var rename = require("gulp-rename") ;
var minifyCss = require("gulp-minify-css") ;
var gulpSequence = require("gulp-sequence") ;
/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
需要编译到css目录下对应目录的less文件路径定义
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
var lessPath = [
    "less/*/*.less" ,
    "!less/mixins/*.less" ,
    "!less/variables/*.less" ,
    "!less/components/*.less"    
] ;
/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
定义对app.less编译的任务
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
gulp.task("app.less" , function() {
     return gulp.src("less/app.less")
        .pipe(less())
        .pipe(minifyCss())
        .pipe(rename(function (path) {
            path.extname = ".wxss" ;
        }))
        .pipe(gulp.dest(".")) ;
}) ;
/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
定义对less编译的任务
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
gulp.task("less" , function() {
     return gulp.src(lessPath)
        .pipe(less())
        .pipe(minifyCss())
        .pipe(rename(function (path) {
            path.extname = ".wxss" ;
        }))
        .pipe(gulp.dest("pages")) ;
}) ;
/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
定义清除wxss文件的任务
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
gulp.task("clean" , function() {
    return gulp.src([
        "app.wxss" ,
        "pages/*/*.wxss"
    ] , {
        read : false
    })
    .pipe(clean()) ;
}) ;
/*-----------------------------------------------------------------------------------------------------------
定义watch任务
-----------------------------------------------------------------------------------------------------------*/
gulp.task("watch" , function() {
    gulp.watch("less/app.less", ["app.less"]) ;  
    gulp.watch(lessPath, ["less"]) ;    
}) ;
/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
定义复合任务
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
gulp.task("default" , ["watch"]) ;
gulp.task("build", gulpSequence("clean", "app.less" , "less")) ;
